{% extends "home.html" %}
{% block content %}
<script type="text/javascript" src="../static/jquery-1.11.3.js"></script>
<script type="text/javascript" src="../static/jquery.legit.js"></script>
<script type="text/javascript" src="../static/loader.js"></script>
<script type=text/javascript>
  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
</script>

<script type=text/javascript>
  $(function() {
    $('a#chartHere').bind('click', function() {
      $.getJSON($SCRIPT_ROOT + '/handleQuery', {
        type: $('input[name="type"]').val(),
        recipientName: $('input[name="recipientName"]').val(),
        recipientEmail: $('input[name="recipientEmail"]').val(),
        creator: $('input[name="creator"]').val(),
        date: $('input[name="date"]').val(),
        chartType: $('input[name="chartType"]').val()
      }, function(results) {
        $("#result").text(results.result);
        console.log(results);

        google.charts.load('current', {'packages':['corechart', 'table']});

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawChart);

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        function drawChart() {
          // Create the data table.

          var data = new google.visualization.DataTable(results);
          console.log("Colors", results);
          data.addColumn('string', 'Recipient Name');
          // data.addColumn('string', 'Type');
          data.addColumn('number', 'Number');
          data.addRows([
            ['Type 1', 3],
            ['Type 2', 1],
            ['Type 3', 1],
            ['Type 4', 1],
            ['Type 5', 2]
          ]);
          console.log(results.result.length);
          // for(var i=0;i<results.result.length; i++){
          //
          // }
          // data.addRows();

          // Set chart options
          var options = {'title':'Awards of Each Type',
                         'width':400,
                         'height':300};

          // Show results in a chart of the user's choice
          var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
          chart.draw(data, options);

          // Show results in a table
          var table = new google.visualization.Table(document.getElementById('table_div'));
          table.draw(data, {showRowNumber: true, width: '70%', height: '100%'});
        }

        });
        return false;
      });
  });
</script>
<div class="container">
  <h3 class="text-muted">Query</h3>
  <p>Search by any of the following parameters. An empty search will return everything.</p>
<form class="form-horizontal">
  <div class="form-group">
    <label for="type" class="col-sm-2 control-label">Award Type</label>
    <div class="col-sm-4">
      <input type="text" class="form-control" id="type" name="type" placeholder="Award Type">
    </div>
  </div>
  <div class="form-group">
    <label for="recipientName" class="col-sm-2 control-label">Recipient Name</label>
    <div class="col-sm-4">
      <input type="text" class="form-control" id="recipientName" placeholder="Recipient Name" name="recipientName">
    </div>
  </div>
  <div class="form-group">
    <label for="recipientEmail" class="col-sm-2 control-label">Recipient Email</label>
    <div class="col-sm-4">
      <input type="text" class="form-control" id="recipientEmail" placeholder="Recipient Email" name="recipientEmail">
    </div>
  </div>
  <div class="form-group">
    <label for="creator" class="col-sm-2 control-label">Creator</label>
    <div class="col-sm-4">
      <input type="text" class="form-control" id="creator" placeholder="Creator" name="creator">
    </div>
  </div>
  <div class="form-group">
    <label for="date" class="col-sm-2 control-label">Date</label>
    <div class="col-sm-4">
      <input type="text" class="form-control" id="date" placeholder="Date" name="date">
    </div>
  </div>
  <div class="form-group">
    <label for="chartType" class="col-sm-2 control-label">Chart Type</label>
    <div class="col-sm-4">
      <input type="text" class="form-control" id="chartType" placeholder="Chart Type" name="chartType">
    </div>
  </div>
  <div class="form-group">
    <label for="sort" class="col-sm-2 control-label">Sort By:</label>
    <div class="col-sm-4">
      <input type="text" class="form-control" id="sort" placeholder="Sort" name="sort">
    </div>
  </div>
  <div class="form-group">
    <div class="col-sm-offset-2 col-sm-4"><a id="chartHere">
      <button type="submit" class="btn btn-default">Get Results</button></a>
    </div>
  </div>
</form>
<span id="result">?</span>

<div id="chart_div"></div>
<div id="table_div"></div>

</div>

<div class="container">
</div>


{% endblock %}
